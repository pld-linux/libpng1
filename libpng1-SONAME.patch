--- libpng-1.0.24/scripts/makefile.linux.orig	2007-04-08 13:54:37.348265617 +0200
+++ libpng-1.0.24/scripts/makefile.linux	2007-04-08 13:57:05.259531415 +0200
@@ -4,8 +4,8 @@
 # For conditions of distribution and use, see copyright notice in png.h
 
 # Library name:
-LIBNAME = libpng10
-PNGMAJ = 0
+LIBNAME = libpng
+PNGMAJ = 2
 PNGMIN = 1.0.24
 PNGVER = $(PNGMAJ).$(PNGMIN)
 
@@ -50,7 +50,7 @@
 CFLAGS= $(OPT_FLAGS) -Wall -funroll-loops \
 	$(ALIGN) # $(WARNMORE) -DPNG_DEBUG=5
 
-LDFLAGS=-L. -Wl,-rpath,. -L$(ZLIBLIB) -Wl,-rpath,$(ZLIBLIB) -lpng10 -lz -lm
+LDFLAGS=-L. -Wl,-rpath,. -L$(ZLIBLIB) -Wl,-rpath,$(ZLIBLIB) -lpng -lz -lm
 LDFLAGS_A=-L$(ZLIBLIB) -Wl,-rpath,$(ZLIBLIB) libpng.a -lz -lm
 
 INCPATH=$(prefix)/include
@@ -110,12 +110,16 @@
 	$(LN_SF) $(LIBSOVER) $(LIBSOMAJ)
 
 $(LIBSOVER): $(OBJSDLL)
-	$(CC) -shared -Wl,-soname,$(LIBSOMAJ) -o $(LIBSOVER) $(OBJSDLL)
+	$(CC) -shared -Wl,-soname,$(LIBSOMAJ) -o $(LIBSOVER) $(OBJSDLL) -lz -lm
+
+libpng10.so.0.$(PNGMIN): $(LIBSOMAJ)
+	ln -sf $(LIBNAME).so.$(PNGVER) libpng10.so.0.$(PNGMIN)
+	ln -sf libpng10.so.0.$(PNGMIN) libpng10.so.0
 
 $(OLDSOVER): $(OBJSDLL)
 	$(CC) -shared -Wl,-soname,$(OLDSOMAJ) \
 	-o $(OLDSOVER) \
-	$(OBJSDLL)
+	$(OBJSDLL) -lz -lm
 
 pngtest: pngtest.o $(LIBSO)
 	$(CC) -o pngtest $(CFLAGS) pngtest.o $(LDFLAGS)
@@ -135,43 +139,42 @@
 
 install-headers: png.h pngconf.h
 	-@if [ ! -d $(DI) ]; then $(MKDIR_P) $(DI); fi
-	-@if [ ! -d $(DI)/$(LIBNAME) ]; then $(MKDIR_P) $(DI)/$(LIBNAME); fi
-	cp png.h pngconf.h $(DI)/$(LIBNAME)
-	chmod 644 $(DI)/$(LIBNAME)/png.h $(DI)/$(LIBNAME)/pngconf.h
+	-@if [ ! -d $(DI)/libpng10 ]; then $(MKDIR_P) $(DI)/libpng10; fi
+	cp png.h pngconf.h $(DI)/libpng10
+	chmod 644 $(DI)/libpng10/png.h $(DI)/libpng10/pngconf.h
 	-@$(RM_F) $(DI)/png.h $(DI)/pngconf.h
 	-@$(RM_F) $(DI)/libpng
-	(cd $(DI); $(LN_SF) $(LIBNAME) libpng; $(LN_SF) $(LIBNAME)/* .)
+	(cd $(DI); $(LN_SF) libpng10 libpng; $(LN_SF) libpng10/* .)
 
 install-static: install-headers libpng.a
 	-@if [ ! -d $(DL) ]; then $(MKDIR_P) $(DL); fi
 	cp libpng.a $(DL)/$(LIBNAME).a
 	chmod 644 $(DL)/$(LIBNAME).a
-	-@$(RM_F) $(DL)/libpng.a
-	(cd $(DL); $(LN_SF) $(LIBNAME).a libpng.a)
+	-@$(RM_F) $(DL)/libpng10.a
+	(cd $(DL); $(LN_SF) $(LIBNAME).a libpng10.a)
 
 install-shared: install-headers $(LIBSOVER) libpng.pc \
-	$(OLDSOVER)
+	libpng10.so.0.$(PNGMIN)
 	-@if [ ! -d $(DL) ]; then $(MKDIR_P) $(DL); fi
 	-@$(RM_F) $(DL)/$(LIBSOVER)* $(DL)/$(LIBSO)
 	-@$(RM_F) $(DL)/$(LIBSOMAJ)
-	-@$(RM_F) $(DL)/$(OLDSO)
-	-@$(RM_F) $(DL)/$(OLDSOMAJ)
-	-@$(RM_F) $(DL)/$(OLDSOVER)*
+	-@$(RM_F) $(DL)/libpng10.so
+	-@$(RM_F) $(DL)/libpng10.so.0
+	-@$(RM_F) $(DL)/libpng10.so.0.$(PNGMIN)*
 	cp $(LIBSOVER) $(DL)
-	cp $(OLDSOVER) $(DL)
 	chmod 755 $(DL)/$(LIBSOVER)
-	chmod 755 $(DL)/$(OLDSOVER)
 	(cd $(DL); \
-	$(LN_SF) $(OLDSOVER) $(OLDSOMAJ); \
-	$(LN_SF) $(OLDSOMAJ) $(OLDSO); \
+	ln -sf $(LIBNAME).so.$(PNGVER) libpng10.so.0.$(PNGMIN); \
+	ln -sf libpng10.so.0.$(PNGMIN) libpng10.so.0; \
+	ln -sf libpng10.so.0 libpng10.so; \
 	$(LN_SF) $(LIBSOVER) $(LIBSOMAJ); \
 	$(LN_SF) $(LIBSOMAJ) $(LIBSO))
 	-@if [ ! -d $(DL)/pkgconfig ]; then $(MKDIR_P) $(DL)/pkgconfig; fi
 	-@$(RM_F) $(DL)/pkgconfig/$(LIBNAME).pc
-	-@$(RM_F) $(DL)/pkgconfig/libpng.pc
+	-@$(RM_F) $(DL)/pkgconfig/libpng10.pc
 	cp libpng.pc $(DL)/pkgconfig/$(LIBNAME).pc
 	chmod 644 $(DL)/pkgconfig/$(LIBNAME).pc
-	(cd $(DL)/pkgconfig; $(LN_SF) $(LIBNAME).pc libpng.pc)
+	(cd $(DL)/pkgconfig; $(LN_SF) $(LIBNAME).pc libpng10.pc)
 
 install-man: libpng.3 libpngpf.3 png.5
 	-@if [ ! -d $(DM) ]; then $(MKDIR_P) $(DM); fi
@@ -186,11 +189,11 @@
 
 install-config: libpng-config
 	-@if [ ! -d $(DB) ]; then $(MKDIR_P) $(DB); fi
-	-@$(RM_F) $(DB)/libpng-config
+	-@$(RM_F) $(DB)/libpng10-config
 	-@$(RM_F) $(DB)/$(LIBNAME)-config
 	cp libpng-config $(DB)/$(LIBNAME)-config
 	chmod 755 $(DB)/$(LIBNAME)-config
-	(cd $(DB); $(LN_SF) $(LIBNAME)-config libpng-config)
+	(cd $(DB); $(LN_SF) $(LIBNAME)-config libpng10-config)
 
 install: install-static install-shared install-man install-config
 
